# Author: Nuno Aguiar
help:
  text   : Retrieves the Docker authentication token for AWS ECR.
  expects: 
  - name     : region
    desc     : AWS region to retrieve the token
    example  : us-east-1
    mandatory: false
  - name     : justtoken
    desc     : If true, only the token is returned without decoding
    example  : "false"
    mandatory: false

todo:
- Get ECR auth token

ojob:
  opacks      :
  - openaf: 20250725
  - AWS
  catch       : printErrnl("[" + job.name + "] "); if (isDef(exception.javaException)) exception.javaException.printStackTrace(); else printErr(exception)
  logToConsole: false   # to change when finished
  loadLibs    :
  - aws.js

jobs:
# -------------------------
- name : Get ECR auth token
  check:
    in:
      region   : isString.default("us-east-1")
      justtoken: toBoolean.isBoolean.default(false)
  exec : | #js
    var aws = new AWS()
    var ecrToken = aws.ECR_GetAuthorizationToken(args.region).authorizationToken
    var decodedToken = args.justtoken ? ow.format.fromBase64(ecrToken).split(":")[1] : ow.format.fromBase64(ecrToken).split(":").join(",")
    printnl(decodedToken)
