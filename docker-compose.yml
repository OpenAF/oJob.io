version : '3'

networks:
  minio:
    driver: bridge

services:
  minio1:
    image         : minio/minio
    container_name: minio1
    command       : server --console-address ":9001" http://minio{1...2}/data{1...2}
    environment   :
      MINIO_ROOT_USER: 'minio'
      MINIO_ROOT_PASSWORD: 'minio123'
      MINIO_DISTRIBUTED_MODE_ENABLED: 'yes'
      MINIO_DISTRIBUTED_NODES: 'minio1,minio2'
    ports         :
    - "9000:9000"
    - "9001:9001"
    healthcheck   :
      test    : [ "CMD-SHELL", "curl --silent --fail http://minio1:9000/minio/health/live || exit 1" ]
      interval: 30s
      timeout : 20s    
      retries : 3          
    volumes :
    - dataminio1-1:/data1
    - dataminio1-2:/data2
    networks:
    - minio
  
  minio2:
    image         : minio/minio
    container_name: minio2
    command       : server  http://minio{1...2}/data{1...2}
    environment   :
      MINIO_ROOT_USER: 'minio'
      MINIO_ROOT_PASSWORD: 'minio123'
      MINIO_DISTRIBUTED_MODE_ENABLED: 'yes'
      MINIO_DISTRIBUTED_NODES: 'minio1,minio2'
      MINIO_SKIP_CLIENT: 'yes'
    healthcheck   :
      test    : [ "CMD-SHELL", "curl --silent --fail http://minio2:9000/minio/health/live || exit 1" ]
      interval: 30s
      timeout : 20s    
      retries : 3          
    volumes :
    - dataminio2-1:/data1
    - dataminio2-2:/data2
    networks:
    - minio
  

volumes:
  dataminio1-1:
  dataminio1-2:
  dataminio2-1:
  dataminio2-2:
