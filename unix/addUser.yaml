# Author: Nuno Aguiar
help:
  text   : Create user in unix prepared with an empty ssh authorized_keys file
  expects: 
  - name     : user
    desc     : The user name to create
    example  : example
    mandatory: true
  - name     : group
    desc     : The optional group name to add the user to
    example  : group
    mandatory: false
  - name     : gecos
    desc     : Add extra optional information
    example  : "John Doe,Room 1234,555-1234,555-5678,John.Doe@example.com"
    mandatory: false

todo:
- Create user

ojob:
  opacks      :
  - openaf: 20230325
  catch       : printErrnl("[" + job.name + "] "); if (isDef(exception.javaException)) exception.javaException.printStackTrace(); else printErr(exception)
  logToConsole: true   # to change when finished
        

jobs:
# ---------------------
- name    : Create user
  check   :
    in:
      user : isString
      group: isString.default(__)
      gecos: isString.default(__)
  lang    : shell
  exec    : |
    sudo adduser {{user}}{{#if group}} -g {{group}}{{/if}}{{#if gecos}} --gecos '{{{gecos}}}'{{/if}}
    sudo mkdir /home/{{user}}/.ssh
    sudo chmod 700 /home/{{user}}/.ssh
    sudo touch /home/{{user}}/.ssh/authorized_keys
    sudo chmod 600 /home/{{user}}/.ssh/authorized_keys
    sudo chown -R {{user}}: /home/{{user}}/.ssh

    echo
    echo To delete just execute \"sudo deluser {{user}} \&\& sudo rm -rf /home/example\"
